{% extends 'base.html' %}

{% block head %}

<link rel="stylesheet" href="{{url_for('static', filename='css/home.css')}}">
<script src="{{url_for('static', filename='js/home.js')}}"></script>

{% endblock %}

{% block body %}

<div id="container">

<div id="room-actions-frame">
  <div class="room-actions-frame-item" style="padding-right: 10px">
    <span class="room-actions-frame-item-title">
      <img src="{{url_for('static', filename='images/crown.svg')}}">
      создать комнату
    </span>
    <div class="input-line">
      <input id="search-release" placeholder="Поиск релиза ..." oninput="searchTitles()" onfocusout="hideSearchResults();hideSearchAnimation();this.value=''">
      <button style="cursor: text;" onmousedown="document.getElementById('search-release').focus()">
        <img id="search-animation" src="{{url_for('static', filename='images/loading.gif')}}" style="transform: scale(0)">
      </button>
      <div id="search-result-container" style="display: none"></div>
    </div>
  </div>
  <div class="room-actions-frame-item" style="padding-left: 10px">
    <span class="room-actions-frame-item-title">
      <img src="{{url_for('static', filename='images/group.svg')}}">
      присоединиться к просмотру
    </span>
    <div class="input-line">
      <input id="room-id-input" placeholder="Номер комнаты ..." onkeydown="if (event.key === 'Enter') {joinRoom()}">
      <button onclick="joinRoom()">
        <img src="{{url_for('static', filename='images/go.svg')}}">
      </button>
    </div>
  </div>
</div>

<hr>

<div id="history-frame">
  <span>История</span>
  <div id="history-container">
    {% for title in history %}

    <div class="history-item"
         onclick="window.open('/watch?title_id={{ title['id'] }}&episode={{ title['last_watched_episode'] }}','_self')">
      <div class="history-item-card">
        <div class="poster-sizer" style="padding-bottom: 142.857%;"></div>
        <div id="poster-{{ title['id'] }}" class="history-item-poster"></div>
        <div class="progress-bar">
          <div style="width: {{ title['last_watched_episode']/title['episodes_count']*100 }}%;"></div>
          <div style="
            opacity: 0.3;
            left: {{ title['last_watched_episode']/title['episodes_count']*100 }}%;
            width: {{ 100-title['last_watched_episode']/title['episodes_count']*100 }}%;"
          ></div>
          {% if title['episodes_count'] == title['last_watched_episode'] %}
          <span>Все эпизоды</span>
          {% elif title['last_watched_episode'] == 0 %}
          <span>Ни одного эпизода</span>
          {% else %}
          <span>{{ title['last_watched_episode'] }} из {{ title['episodes_count'] }} эпизодов</span>
          {% endif %}
        </div>
      </div>
    </div>
    <script>title_ids.push({{ title['id'] }})</script>

    {% endfor %}
  </div>
</div>

</div>

{% endblock %}